
# 智能旅行推荐助手

一款基于大模型的智能化旅行推荐助手，通过表单收集用户需求，结合高德地图POI搜索和大模型AI，自动生成详细的旅行行程安排，包含天气信息和穿搭建议。

## 功能特性

- 📝 **智能表单填写**：提供友好的表单界面，支持出发地、目的地、出行日期、同行人数等信息的输入
- 🔍 **城市智能搜索**：出发地和目的地支持模糊搜索，自动匹配城市列表，也支持自定义输入任意地点
- 📅 **灵活日期输入**：支持自定义日期格式输入，如"2025-12-15 至 2025-12-20"
- 👥 **同行人数选择**：下拉选择同行人数（1人、2人、3人、4人、5+人等）
- 🗺️ **高德地图集成**：自动搜索目的地城市的POI（兴趣点）和地点信息
- 🤖 **AI智能推荐**：基于大模型（通义千问）生成个性化推荐理由和详细行程安排
- 🌤️ **天气信息**：直接集成高德地图天气API，获取实时天气和未来3天天气预报
- 👔 **穿搭建议**：根据天气情况，分别提供女生和男生的穿搭建议
- 📱 **鸿蒙原生应用**：使用ArkTS开发，适配HarmonyOS手
- 🎨 **优化渲染**：自动清理Markdown格式标记，提供友好的文本展示

## 项目结构

```
ai_tour_recommander/
├── entry/
│   └── src/main/
│       ├── ets/
│       │   ├── common/          # 通用工具
│       │   │   ├── config.ts    # 配置加载
│       │   │   └── httpClient.ts # HTTP客户端
│       │   ├── services/        # API服务层
│       │   │   ├── amapService.ts    # 高德地图服务（POI搜索、地理编码）
│       │   │   ├── llmService.ts      # 大模型服务（通义千问）
│       │   │   └── types.ts           # 类型定义
│       │   ├── domain/          # 业务逻辑层
│       │   │   ├── recommendationUseCase.ts # 推荐用例（组合POI搜索和AI推荐）
│       │   │   └── mockData.ts         # Mock数据
│       │   ├── pages/           # UI页面
│       │   │   ├── TravelForm.ets    # 旅行需求表单页面（主页面）
│       │   │   └── Index.ets          # 推荐结果展示页面
│       │   └── entryability/
│       │       └── EntryAbility.ets   # 应用入口
│       └── resources/
│           └── rawfile/
│               ├── config.sample.json # 配置文件示例
│               └── config.json        # 实际配置文件（已加入.gitignore）
```

## 配置说明

### 1. 创建配置文件

复制示例配置文件并填入你的API密钥：

```bash
cp entry/src/main/resources/rawfile/config.sample.json entry/src/main/resources/rawfile/config.json
```

### 2. 编辑配置文件

编辑 `entry/src/main/resources/rawfile/config.json`，填入以下信息：

```json
{
  "amapKey": "你的高德地图API密钥",
  "amapBaseUrl": "https://restapi.amap.com/v3",
  "llmApiKey": "你的大模型API密钥",
  "llmBaseUrl": "https://dashscope.aliyuncs.com/compatible-mode/v1",
  "llmModel": "qwen-plus",
  "llmSystemPrompt": "你是一个专业的旅行路线推荐助手...",
  "defaultCity": "北京",
  "networkTimeout": 60000,
  "mockMode": false,
  "llmEnableSearch": true
}
```

### 配置项说明

- `amapKey`: 高德地图API密钥（必填）
- `llmApiKey`: 通义千问API密钥（必填）
- `llmModel`: 大模型名称，默认"qwen-plus"
- `llmSystemPrompt`: 系统提示词，用于指导大模型生成推荐内容
- `llmEnableSearch`: 是否开启大模型联网搜索功能（默认true），用于获取天气等信息
- `networkTimeout`: 网络请求超时时间（毫秒），默认60000（60秒）
- `mockMode`: 是否使用Mock模式（默认false）

### 3. 获取API密钥

#### 高德地图API密钥
1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册/登录账号
3. 创建应用并获取Key
4. 确保开通"Web服务API"权限

#### 大模型API密钥（通义千问）
1. 访问 [阿里云百炼平台](https://bailian.console.aliyun.com/)
2. 注册/登录账号
3. 创建API Key
4. 确保账户有足够余额

### 4. Mock模式

如果未配置API密钥或配置文件不存在，应用会自动进入Mock模式，使用预设的演示数据。

## 使用说明

### 表单填写

1. **出发地**：选择或输入出发城市，支持模糊搜索和自定义输入
2. **目的地**（必填）：选择或输入目的地城市，支持模糊搜索和自定义输入
3. **出行日期**：输入日期，如"2025-12-15 至 2025-12-20"
4. **旅行天数**：输入天数，如"3天"
5. **同行人数**：下拉选择（1人、2人、3人、4人、5+人等）
6. **预算范围**（可选）：输入预算，如"3000-5000元"
7. **兴趣偏好**：选择感兴趣的类型（美食、自然风光、城市漫步等）
8. **节假日快捷选择**：可选择节假日进行快速规划
9. **其他选项**：生成预算、生成地图链接、查询天气信息、路线规划等

### 工作流程

1. 用户在表单中填写旅行需求（目的地、出发地、日期、人数等）
2. 系统根据目的地城市调用高德地图API搜索相关POI（景点、餐厅等）
3. 将用户需求和POI列表传递给大模型API
4. 大模型生成详细的行程安排，包含：
   - 行程标题和概览
   - 每天的详细安排（时间、地点、描述、地图链接）
   - 每天的天气信息（温度、天气状况、风力等）
   - 每天的穿搭建议（分别提供女生和男生的建议）
5. 展示格式化后的推荐结果（自动清理Markdown标记）

### 输出示例

生成的行程包含：
- **出行概览**：出发地、目的地、出行人数、行程天数、总预算等
- **每天行程**：
  - 时间安排（如：09:00 - 11:30）
  - 地点名称和详细描述
  - 地图链接（高德地图）
  - 天气信息（日期、温度、天气状况、风力）
  - 穿搭建议（女生和男生分别提供）

## 开发说明

### 技术栈

- **开发语言**：ArkTS
- **UI框架**：ArkUI
- **目标平台**：HarmonyOS手机
- **开发工具**：DevEco Studio

### 构建和运行

1. 使用DevEco Studio打开项目
2. 配置好API密钥（见上方配置说明）
3. 连接HarmonyOS设备或启动模拟器
4. 点击运行按钮

### 网络权限

确保在 `entry/src/main/module.json5` 中配置了网络权限：

```json5
{
  "module": {
    "requestPermissions": [
      {
        "name": "ohos.permission.INTERNET"
      }
    ]
  }
}
```

## 注意事项

1. **配置文件安全**：`config.json` 已在 `.gitignore` 中，不会被提交到版本控制
2. **API配额**：注意高德地图和大模型API的调用配额限制
3. **网络超时**：默认超时时间为60秒（大模型生成需要较长时间），可在配置中调整
4. **错误处理**：应用会自动降级到Mock模式，确保即使API不可用也能演示
5. **目的地识别**：系统会优先使用表单中填写的目的地城市进行POI搜索，确保搜索结果的准确性
6. **天气信息**：天气信息直接通过高德地图天气API获取，无需依赖大模型的联网搜索功能
7. **Markdown渲染**：输出结果会自动清理Markdown格式标记，提供友好的文本展示

## 技术实现

### 核心功能

1. **城市搜索**：
   - 内置100+中国主要城市列表，按拼音首字母排序
   - 支持模糊搜索，实时显示匹配建议
   - 支持自定义输入任意地点

2. **POI搜索**：
   - 使用高德地图POI搜索API
   - 根据目的地城市自动搜索相关景点、餐厅等
   - 支持关键词搜索（景点、旅游、美食等）

3. **天气查询**：
   - 使用高德地图天气API
   - 自动获取目的地城市的实时天气（温度、天气现象、风向、风力、湿度等）
   - 获取未来3天的天气预报（白天/夜间天气、温度、风向、风力等）
   - 自动将天气信息传递给大模型，用于生成穿搭建议

4. **AI推荐生成**：
   - 使用通义千问（qwen-plus）模型
   - 根据用户需求、POI列表和天气信息生成详细行程
   - 结合天气信息提供穿搭建议

4. **结果渲染**：
   - 自动清理Markdown格式标记（##、**等）
   - 智能识别标题和正文，应用不同样式
   - 保持合理的段落间距和可读性

### 已实现功能

- ✅ 旅行需求表单（出发地、目的地、日期、人数、预算、兴趣等）
- ✅ 城市模糊搜索和自定义输入
- ✅ 高德地图POI搜索集成
- ✅ 高德地图天气API集成（实时天气和天气预报）
- ✅ 大模型推荐生成（通义千问）
- ✅ 天气信息自动获取和传递
- ✅ 穿搭建议生成（基于天气信息）
- ✅ Markdown格式清理和优化渲染
- ✅ 错误处理和降级机制

## 后续优化方向

- [x] ~~集成高德天气API，直接获取准确的天气数据~~（已完成）
- [ ] 添加路线规划功能，显示POI之间的导航路线
- [ ] 支持语音输入
- [ ] 集成美团/大众点评API获取更丰富的POI信息（评分、评论等）
- [ ] 添加收藏和历史记录功能
- [ ] 支持多城市切换和城市推荐
- [ ] 优化UI设计，添加地图展示
- [ ] 支持行程导出（PDF、图片等）
- [ ] 添加用户反馈和评价功能

## 许可证

本项目仅供学习和演示使用。

# 可运行的APP位置

```
ai_tour_recommander\build\outputs\default\ai_tour_recommander-default-unsigned.app
```